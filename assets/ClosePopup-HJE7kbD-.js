import{X as q,m as s,o as k,Y as g,C as l,s as H,Z as _,j as K}from"./index-C4piQ-VK.js";import{o as M,n as V,t as X,w as Y,x as W}from"./position-engine-DpI_bKZe.js";const c=[];let u;function z(e){u=e.keyCode===27}function A(){u===!0&&(u=!1)}function F(e){u===!0&&(u=!1,q(e,27)===!0&&c[c.length-1](e))}function S(e){window[e]("keydown",z),window[e]("blur",A),window[e]("keyup",F),u=!1}function N(e){s.is.desktop===!0&&(c.push(e),c.length===1&&S("addEventListener"))}function j(e){const t=c.indexOf(e);t!==-1&&(c.splice(t,1),c.length===0&&S("removeEventListener"))}const a=[];function C(e){a[a.length-1](e)}function I(e){s.is.desktop===!0&&(a.push(e),a.length===1&&document.body.addEventListener("focusin",C))}function R(e){const t=a.indexOf(e);t!==-1&&(a.splice(t,1),a.length===0&&document.body.removeEventListener("focusin",C))}function Z(e,t,o){let n;function r(){n!==void 0&&(g.remove(n),n=void 0)}return k(()=>{e.value===!0&&r()}),{removeFromHistory:r,addToHistory(){n={condition:()=>o.value===!0,handler:t},g.add(n)}}}let f=0,h,m,p,y=!1,b,L,E,d=null;function $(e){B(e)&&H(e)}function B(e){if(e.target===document.body||e.target.classList.contains("q-layout__backdrop"))return!0;const t=_(e),o=e.shiftKey&&!e.deltaX,n=!o&&Math.abs(e.deltaX)<=Math.abs(e.deltaY),r=o||n?e.deltaY:e.deltaX;for(let w=0;w<t.length;w++){const i=t[w];if(X(i,n))return n?r<0&&i.scrollTop===0?!0:r>0&&i.scrollTop+i.clientHeight===i.scrollHeight:r<0&&i.scrollLeft===0?!0:r>0&&i.scrollLeft+i.clientWidth===i.scrollWidth}return!0}function T(e){e.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function v(e){y!==!0&&(y=!0,requestAnimationFrame(()=>{y=!1;const{height:t}=e.target,{clientHeight:o,scrollTop:n}=document.scrollingElement;(p===void 0||t!==window.innerHeight)&&(p=o-t,document.scrollingElement.scrollTop=n),n>p&&(document.scrollingElement.scrollTop-=Math.ceil((n-p)/8))}))}function x(e){const t=document.body,o=window.visualViewport!==void 0;if(e==="add"){const{overflowY:n,overflowX:r}=window.getComputedStyle(t);h=M(window),m=V(window),b=t.style.left,L=t.style.top,E=window.location.href,t.style.left=`-${h}px`,t.style.top=`-${m}px`,r!=="hidden"&&(r==="scroll"||t.scrollWidth>window.innerWidth)&&t.classList.add("q-body--force-scrollbar-x"),n!=="hidden"&&(n==="scroll"||t.scrollHeight>window.innerHeight)&&t.classList.add("q-body--force-scrollbar-y"),t.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,s.is.ios===!0&&(o===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",v,l.passiveCapture),window.visualViewport.addEventListener("scroll",v,l.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",T,l.passiveCapture))}s.is.desktop===!0&&s.is.mac===!0&&window[`${e}EventListener`]("wheel",$,l.notPassive),e==="remove"&&(s.is.ios===!0&&(o===!0?(window.visualViewport.removeEventListener("resize",v,l.passiveCapture),window.visualViewport.removeEventListener("scroll",v,l.passiveCapture)):window.removeEventListener("scroll",T,l.passiveCapture)),t.classList.remove("q-body--prevent-scroll"),t.classList.remove("q-body--force-scrollbar-x"),t.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,t.style.left=b,t.style.top=L,window.location.href===E&&window.scrollTo(h,m),p=void 0)}function D(e){let t="add";if(e===!0){if(f++,d!==null){clearTimeout(d),d=null;return}if(f>1)return}else{if(f===0||(f--,f>0))return;if(t="remove",s.is.ios===!0&&s.is.nativeMobile===!0){d!==null&&clearTimeout(d),d=setTimeout(()=>{x(t),d=null},100);return}}x(t)}function G(){let e;return{preventBodyScroll(t){t!==e&&(e!==void 0||t===!0)&&(e=t,D(t))}}}function J(e,t,o){return o<=t?t:Math.min(o,Math.max(t,e))}function P(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}const Q=K({name:"close-popup",beforeMount(e,{value:t}){const o={depth:P(t),handler(n){o.depth!==0&&setTimeout(()=>{const r=Y(e);r!==void 0&&W(r,n,o.depth)})},handlerKey(n){q(n,13)===!0&&o.handler(n)}};e.__qclosepopup=o,e.addEventListener("click",o.handler),e.addEventListener("keyup",o.handlerKey)},updated(e,{value:t,oldValue:o}){t!==o&&(e.__qclosepopup.depth=P(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}});export{Q as C,I as a,j as b,N as c,G as d,J as e,R as r,Z as u};
