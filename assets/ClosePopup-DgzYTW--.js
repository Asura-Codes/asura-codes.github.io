import{X as q,m as s,o as k,Y as g,C as l,s as H,Z as _,j as K}from"./index-BluQ80Xx.js";import{o as V,n as X,t as Y,w as M,x as W}from"./position-engine-BVdP6v0v.js";const c=[];let u;function z(e){u=e.keyCode===27}function A(){u===!0&&(u=!1)}function F(e){u===!0&&(u=!1,q(e,27)===!0&&c[c.length-1](e))}function S(e){window[e]("keydown",z),window[e]("blur",A),window[e]("keyup",F),u=!1}function N(e){s.is.desktop===!0&&(c.push(e),c.length===1&&S("addEventListener"))}function j(e){const t=c.indexOf(e);t!==-1&&(c.splice(t,1),c.length===0&&S("removeEventListener"))}const a=[];function C(e){a[a.length-1](e)}function I(e){s.is.desktop===!0&&(a.push(e),a.length===1&&document.body.addEventListener("focusin",C))}function R(e){const t=a.indexOf(e);t!==-1&&(a.splice(t,1),a.length===0&&document.body.removeEventListener("focusin",C))}function Z(e,t,n){let o;function r(){o!==void 0&&(g.remove(o),o=void 0)}return k(()=>{e.value===!0&&r()}),{removeFromHistory:r,addToHistory(){o={condition:()=>n.value===!0,handler:t},g.add(o)}}}let f=0,h,m,p,y=!1,b,L,E,d=null;function $(e){B(e)&&H(e)}function B(e){if(e.target===document.body||e.target.classList.contains("q-layout__backdrop"))return!0;const t=_(e),n=e.shiftKey&&!e.deltaX,o=!n&&Math.abs(e.deltaX)<=Math.abs(e.deltaY),r=n||o?e.deltaY:e.deltaX;for(let w=0;w<t.length;w++){const i=t[w];if(Y(i,o))return o?r<0&&i.scrollTop===0?!0:r>0&&i.scrollTop+i.clientHeight===i.scrollHeight:r<0&&i.scrollLeft===0?!0:r>0&&i.scrollLeft+i.clientWidth===i.scrollWidth}return!0}function T(e){e.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function v(e){y!==!0&&(y=!0,requestAnimationFrame(()=>{y=!1;const{height:t}=e.target,{clientHeight:n,scrollTop:o}=document.scrollingElement;(p===void 0||t!==window.innerHeight)&&(p=n-t,document.scrollingElement.scrollTop=o),o>p&&(document.scrollingElement.scrollTop-=Math.ceil((o-p)/8))}))}function x(e){const t=document.body,n=window.visualViewport!==void 0;if(e==="add"){const{overflowY:o,overflowX:r}=window.getComputedStyle(t);h=V(window),m=X(window),b=t.style.left,L=t.style.top,E=window.location.href,t.style.left=`-${h}px`,t.style.top=`-${m}px`,r!=="hidden"&&(r==="scroll"||t.scrollWidth>window.innerWidth)&&t.classList.add("q-body--force-scrollbar-x"),o!=="hidden"&&(o==="scroll"||t.scrollHeight>window.innerHeight)&&t.classList.add("q-body--force-scrollbar-y"),t.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,s.is.ios===!0&&(n===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",v,l.passiveCapture),window.visualViewport.addEventListener("scroll",v,l.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",T,l.passiveCapture))}s.is.desktop===!0&&s.is.mac===!0&&window[`${e}EventListener`]("wheel",$,l.notPassive),e==="remove"&&(s.is.ios===!0&&(n===!0?(window.visualViewport.removeEventListener("resize",v,l.passiveCapture),window.visualViewport.removeEventListener("scroll",v,l.passiveCapture)):window.removeEventListener("scroll",T,l.passiveCapture)),t.classList.remove("q-body--prevent-scroll"),t.classList.remove("q-body--force-scrollbar-x"),t.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,t.style.left=b,t.style.top=L,window.location.href===E&&window.scrollTo(h,m),p=void 0)}function D(e){let t="add";if(e===!0){if(f++,d!==null){clearTimeout(d),d=null;return}if(f>1)return}else{if(f===0||(f--,f>0))return;if(t="remove",s.is.ios===!0&&s.is.nativeMobile===!0){d!==null&&clearTimeout(d),d=setTimeout(()=>{x(t),d=null},100);return}}x(t)}function G(){let e;return{preventBodyScroll(t){t!==e&&(e!==void 0||t===!0)&&(e=t,D(t))}}}function P(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}const J=K({name:"close-popup",beforeMount(e,{value:t}){const n={depth:P(t),handler(o){n.depth!==0&&setTimeout(()=>{const r=M(e);r!==void 0&&W(r,o,n.depth)})},handlerKey(o){q(o,13)===!0&&n.handler(o)}};e.__qclosepopup=n,e.addEventListener("click",n.handler),e.addEventListener("keyup",n.handlerKey)},updated(e,{value:t,oldValue:n}){t!==n&&(e.__qclosepopup.depth=P(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}});export{J as C,I as a,j as b,N as c,G as d,R as r,Z as u};
